<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResenhaTale: Hard Mode ðŸ‘€</title>
    <style>
        @font-face {
            font-family: 'Determination';
            src: url('https://fonts.cdnfonts.com/s/15443/DeterminationMonoWebRegular.woff') format('woff');
        }

        body {
            background-color: black;
            color: white;
            font-family: 'Determination', 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* INIMIGO */
        #enemy-container {
            height: 200px;
            text-align: center;
            position: relative;
        }

        #enemy-img {
            width: 140px;
            transition: opacity 2s ease-out, filter 0.1s;
        }

        .enemy-hp-bar {
            width: 150px; height: 12px; background: #333;
            border: 2px solid white; margin: 10px auto;
        }
        #enemy-hp-fill { width: 100%; height: 100%; background: #00ff00; transition: 0.3s; }

        /* CAIXA DE BATALHA */
        #box {
            width: 400px; height: 180px;
            border: 5px solid white;
            position: relative;
            background: black;
            padding: 15px;
            box-sizing: border-box;
            overflow: hidden;
        }

        #soul {
            position: absolute; width: 16px; height: 16px;
            display: none; z-index: 100;
        }

        .bullet { position: absolute; background: white; pointer-events: none; border-radius: 2px; }

        /* SISTEMA DE ATAQUE (SLIDER) */
        #attack-slider-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center;
        }
        #slider-bg {
            width: 350px; height: 120px; border: 4px solid #444;
            background: url('https://i.imgur.com/8mX7N8I.png') center/cover; position: relative;
        }
        #slider-bar {
            position: absolute; width: 12px; height: 100%; background: white;
            box-shadow: 0 0 15px white; left: 0;
        }

        /* STATUS */
        #status { width: 400px; margin: 15px 0; display: flex; align-items: center; }
        .hp-bar-bg { width: 100px; height: 20px; background: red; margin: 0 10px; }
        #hp-fill { width: 100%; height: 100%; background: #ffff00; }
        .poisoned { background: #800080 !important; }

        /* BOTÃ•ES */
        .buttons { display: flex; gap: 10px; width: 420px; justify-content: space-between; }
        .btn {
            border: 2px solid #e27d31; color: #e27d31;
            padding: 8px; width: 95px; text-align: center; cursor: pointer;
        }
        .btn:hover, .btn.selected { border-color: white; color: white; background: #e27d31; }

        /* GAME OVER */
        #game-over {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000;
        }
        #death-soul { width: 20px; margin-bottom: 20px; }
        .stay-determined { color: white; text-align: center; font-size: 24px; animation: fadeIn 3s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        #dialogue { font-size: 18px; line-height: 1.4; }
    </style>
</head>
<body>

    <div id="enemy-container">
        <canvas id="dust-canvas" style="position:absolute; top:0; left:50%; transform:translateX(-50%); pointer-events:none;"></canvas>
        <img src="resenha.png" id="enemy-img" alt="ðŸ‘€" onerror="this.src='https://emojicdn.elk.sh/ðŸ‘€?size=140'">
        <div class="enemy-hp-bar"><div id="enemy-hp-fill"></div></div>
    </div>

    <div id="box">
        <div id="dialogue"></div>
        <img id="soul" src="https://i.imgur.com/u7f3RCH.png" alt="â¤ï¸">
        
        <!-- Sistema de Ataque Estilo Undertale -->
        <div id="attack-slider-container">
            <div id="slider-bg">
                <div id="slider-bar"></div>
            </div>
        </div>
    </div>

    <div id="status">
        VOCÃŠ  LV 19  HP <div class="hp-bar-bg"><div id="hp-fill"></div></div> <span id="hp-text">50 / 50</span>
    </div>

    <div class="buttons">
        <div class="btn" id="btn-fight" onclick="startAttackMiniGame()">LUTAR</div>
        <div class="btn" onclick="openMenu('act')">AGIR</div>
        <div class="btn" onclick="openMenu('item')">ITEM</div>
        <div class="btn" onclick="openMenu('mercy')">POUPAR</div>
    </div>

    <!-- TELA DE MORTE -->
    <div id="game-over">
        <img id="death-soul" src="https://i.imgur.com/u7f3RCH.png">
        <div class="stay-determined">
            Parece que a resenha foi demais para vocÃª...<br><br>
            <span style="color: #ff0000; font-size: 30px;">MANTENHA-SE DETERMINADO!</span><br><br>
            <button onclick="location.reload()" style="background:none; border:2px solid white; color:white; padding:10px; cursor:pointer;">TENTAR NOVAMENTE</button>
        </div>
    </div>

    <script>
        const soul = document.getElementById('soul');
        const box = document.getElementById('box');
        const dialogue = document.getElementById('dialogue');
        const hpFill = document.getElementById('hp-fill');
        const hpText = document.getElementById('hp-text');
        const enemyHpFill = document.getElementById('enemy-hp-fill');
        const sliderContainer = document.getElementById('attack-slider-container');
        const sliderBar = document.getElementById('slider-bar');

        let playerHp = 50, maxHp = 50;
        let enemyHp = 150, maxEnemyHp = 150;
        let gameState = 'menu'; // menu, typing, enemy_turn, attacking, dead
        let soulX = 192, soulY = 72;
        let keys = {};
        let poison = 0;

        let inventory = [
            { name: "Sucu do Istilitiru", heal: 25 },
            { name: "Chocolate", heal: 15 },
            { name: "Bosta", heal: -10, poison: 8 }
        ];

        function typeWriter(text, callback) {
            gameState = 'typing';
            dialogue.innerHTML = "";
            let i = 0;
            const interval = setInterval(() => {
                dialogue.innerHTML += text.charAt(i);
                i++;
                if (i >= text.length) {
                    clearInterval(interval);
                    gameState = 'menu';
                    if (callback) callback();
                }
            }, 30);
        }

        typeWriter("* A resenha ðŸ‘€ te observa com desprezo.");

        // SISTEMA DE ATAQUE (MINIGAME)
        let sliderPos = 0;
        let sliderDir = 1;
        let sliderActive = false;

        function startAttackMiniGame() {
            if (gameState !== 'menu') return;
            gameState = 'attacking';
            sliderContainer.style.display = 'flex';
            sliderPos = 0;
            sliderActive = true;
            animateSlider();
        }

        function animateSlider() {
            if (!sliderActive) return;
            sliderPos += 5 * sliderDir;
            if (sliderPos >= 340 || sliderPos <= 0) sliderDir *= -1;
            sliderBar.style.left = sliderPos + 'px';
            requestAnimationFrame(animateSlider);
        }

        window.addEventListener('keydown', (e) => {
            if (e.key === 'z' || e.key === 'Enter') {
                if (gameState === 'attacking' && sliderActive) {
                    sliderActive = false;
                    calculateDamage();
                }
            }
        });

        function calculateDamage() {
            // Quanto mais perto do meio (175px), mais dano.
            let dist = Math.abs(175 - sliderPos);
            let damage = 0;
            
            if (dist < 20) damage = 25; // Perfeito
            else if (dist < 60) damage = 15; // Bom
            else if (dist < 120) damage = 7; // Ruim
            else damage = 0; // Errou

            enemyHp -= damage;
            updateEnemyUI();

            sliderContainer.style.display = 'none';
            typeWriter(`* VocÃª desferiu ${damage} de dano!`, () => {
                setTimeout(enemyHp <= 0 ? dieEnemy : startEnemyTurn, 1000);
            });
        }

        function updateEnemyUI() {
            enemyHpFill.style.width = Math.max(0, (enemyHp / maxEnemyHp) * 100) + "%";
            const img = document.getElementById('enemy-img');
            img.style.filter = "invert(1)";
            setTimeout(() => img.style.filter = "none", 100);
        }

        // TURNOS DO INIMIGO (DIFÃCEIS)
        function startEnemyTurn() {
            gameState = 'enemy_turn';
            dialogue.innerHTML = "";
            soul.style.display = 'block';
            soulX = 192; soulY = 72;
            
            let pattern = Math.floor(Math.random() * 3);
            let timer = 0;
            
            const turnInterval = setInterval(() => {
                timer++;
                if (pattern === 0) attackFollower(); // Persegue o player
                if (pattern === 1) attackWalls();    // Paredes rÃ¡pidas
                if (pattern === 2) attackChaos();    // Tudo junto
                
                if (timer > 20) {
                    clearInterval(turnInterval);
                    setTimeout(endEnemyTurn, 1500);
                }
            }, 400);
        }

        function attackFollower() { // TIROS QUE MIRAM NO PLAYER
            if (gameState !== 'enemy_turn') return;
            createBullet(Math.random() > 0.5 ? 0 : 380, Math.random() * 150, (soulX - 200)/50, (soulY - 80)/50, 15, 15);
        }

        function attackWalls() { // PAREDES QUE EXIGEM MOVIMENTO CONSTANTE
            if (gameState !== 'enemy_turn') return;
            createBullet(-10, 0, 6, 0, 15, 180); // Parede vertical varrendo
            createBullet(390, 0, -6, 0, 15, 180); 
        }

        function attackChaos() {
             createBullet(Math.random() * 380, -10, (Math.random()-0.5)*4, 5, 10, 10);
        }

        function createBullet(x, y, vx, vy, w, h) {
            const b = document.createElement('div');
            b.className = 'bullet';
            b.style.width = w + 'px'; b.style.height = h + 'px';
            box.appendChild(b);

            const move = setInterval(() => {
                x += vx; y += vy;
                b.style.left = x + 'px'; b.style.top = y + 'px';

                if (x < soulX + 12 && x + w > soulX && y < soulY + 12 && y + h > soulY) {
                    takeDamage(1);
                }

                if (x < -100 || x > 500 || y < -100 || y > 300 || gameState !== 'enemy_turn') {
                    b.remove(); clearInterval(move);
                }
            }, 20);
        }

        function takeDamage(amt) {
            playerHp -= amt;
            updatePlayerUI();
            if (playerHp <= 0) triggerGameOver();
        }

        function updatePlayerUI() {
            hpFill.style.width = (playerHp / maxHp * 100) + "%";
            hpText.innerText = Math.ceil(playerHp) + " / " + maxHp;
            if (poison > 0) hpFill.classList.add('poisoned');
            else hpFill.classList.remove('poisoned');
        }

        function endEnemyTurn() {
            gameState = 'menu';
            soul.style.display = 'none';
            typeWriter("* VocÃª sente seus pecados pesando nas costas.");
        }

        // MORTE DO INIMIGO (POEIRA)
        function dieEnemy() {
            gameState = 'win';
            const canvas = document.getElementById('dust-canvas');
            const ctx = canvas.getContext('2d');
            const img = document.getElementById('enemy-img');
            canvas.width = 200; canvas.height = 200;
            
            img.style.opacity = '0';
            
            // SimulaÃ§Ã£o simples de poeira
            let particles = [];
            for(let i=0; i<100; i++) particles.push({x:100, y:100, vx:Math.random()-0.5, vy:Math.random()-0.5, a:1});

            const anim = setInterval(() => {
                ctx.clearRect(0,0,200,200);
                particles.forEach(p => {
                    p.x += p.vx * 2; p.y += p.vy * 2; p.a -= 0.01;
                    ctx.fillStyle = `rgba(150, 150, 150, ${p.a})`;
                    ctx.fillRect(p.x, p.y, 3, 3);
                });
                if (particles[0].a <= 0) clearInterval(anim);
            }, 20);

            typeWriter("* A resenha se desfez em poeira.\n* VocÃª venceu.");
        }

        function triggerGameOver() {
            gameState = 'dead';
            document.getElementById('game-over').style.display = 'flex';
        }

        // CONTROLES E LOOP
        window.addEventListener('keydown', e => keys[e.key] = true);
        window.addEventListener('keyup', e => keys[e.key] = false);

        function openMenu(m) {
            if (gameState !== 'menu') return;
            if (m === 'item') {
                gameState = 'item_select';
                dialogue.innerHTML = "ITENS:<br>";
                inventory.forEach((it, i) => {
                    dialogue.innerHTML += `<div onclick="useItem(${i})">> ${it.name}</div>`;
                });
            } else {
                typeWriter("* AÃ§Ã£o indisponÃ­vel agora.");
            }
        }

        function useItem(i) {
            const it = inventory[i];
            playerHp += it.heal;
            if (it.poison) poison = it.poison;
            inventory.splice(i, 1);
            updatePlayerUI();
            typeWriter(`* VocÃª usou ${it.name}.`, startEnemyTurn);
        }

        setInterval(() => {
            if (gameState === 'enemy_turn') {
                const speed = 3.5;
                if (keys['ArrowUp'] || keys['w']) soulY -= speed;
                if (keys['ArrowDown'] || keys['s']) soulY += speed;
                if (keys['ArrowLeft'] || keys['a']) soulX -= speed;
                if (keys['ArrowRight'] || keys['d']) soulX += speed;
                soulX = Math.max(0, Math.min(384, soulX));
                soulY = Math.max(0, Math.min(164, soulY));
                soul.style.left = soulX + 'px';
                soul.style.top = soulY + 'px';
            }
            if (poison > 0) {
                playerHp -= 0.1;
                poison -= 0.1;
                updatePlayerUI();
            }
        }, 20);

    </script>
</body>
</html>
