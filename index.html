<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoJS Pro - Clone Photoshop</title>
    <style>
        :root {
            --bg-main: #1e1e1e;
            --bg-sidebar: #252526;
            --bg-panel: #333333;
            --accent: #0078d4;
            --border: #454545;
            --text: #cccccc;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-main);
            color: var(--text);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- HEADER --- */
        header {
            background: var(--bg-sidebar);
            height: 40px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid var(--border);
            gap: 20px;
        }

        .menu-item { cursor: pointer; font-size: 13px; }
        .menu-item:hover { color: white; }

        /* --- TOOLBAR (TOP) --- */
        .tool-options {
            background: var(--bg-panel);
            height: 45px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 15px;
            font-size: 12px;
            border-bottom: 1px solid var(--border);
        }

        input[type="range"] { accent-color: var(--accent); width: 80px; }

        /* --- MAIN LAYOUT --- */
        .main-body {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Lateral Tools */
        .sidebar-tools {
            width: 50px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
            gap: 15px;
        }

        .tool-icon {
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            font-size: 18px;
        }

        .tool-icon:hover { background: #444; }
        .tool-icon.active { background: var(--accent); color: white; }

        /* Canvas Area */
        .workspace {
            flex: 1;
            background: #121212;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: auto;
            padding: 50px;
        }

        #canvas-container {
            position: relative;
            background: white;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            cursor: crosshair;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none; /* S√≥ a camada ativa recebe cliques */
        }

        canvas.active-layer { pointer-events: auto; }

        /* Right Panels */
        .right-panels {
            width: 260px;
            background: var(--bg-sidebar);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .panel-header {
            background: #3c3c3c;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .layer-list {
            flex: 1;
            overflow-y: auto;
            padding: 5px;
        }

        .layer-item {
            background: #333;
            margin-bottom: 2px;
            padding: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .layer-item.selected { border-color: var(--accent); background: #444; }
        .layer-item .visibility { cursor: pointer; width: 20px; }

        .layer-controls {
            padding: 10px;
            display: flex;
            justify-content: space-around;
            border-top: 1px solid var(--border);
        }

        .btn-sm {
            background: #444;
            border: none;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }

        .btn-sm:hover { background: var(--accent); }
    </style>
</head>
<body>

<header>
    <div class="menu-item" onclick="newProject()">Arquivo</div>
    <div class="menu-item">Editar</div>
    <div class="menu-item">Imagem</div>
    <div class="menu-item" style="color:var(--accent)">PhotoJS Pro v2.0</div>
</header>

<div class="tool-options">
    <label>Tamanho:</label>
    <input type="range" id="brush-size" min="1" max="100" value="10">
    <label>Opacidade:</label>
    <input type="range" id="brush-opacity" min="1" max="100" value="100">
    <label>Tipo:</label>
    <select id="brush-type">
        <option value="round">Circular</option>
        <option value="square">Quadrado</option>
        <option value="soft">Airbrush (Macio)</option>
    </select>
    <label>Cor:</label>
    <input type="color" id="color-picker" value="#000000">
</div>

<div class="main-body">
    <aside class="sidebar-tools">
        <div class="tool-icon active" title="Pincel (B)" id="tool-brush">üñåÔ∏è</div>
        <div class="tool-icon" title="Borracha (E)" id="tool-eraser">üßΩ</div>
        <div class="tool-icon" title="Texto (T)" id="tool-text">T</div>
        <div class="tool-icon" title="Mover (V)" id="tool-move">üñ±Ô∏è</div>
        <hr style="width: 60%; border-color: #444;">
        <button onclick="undo()" title="Undo (Ctrl+Z)" style="background:none; border:none; cursor:pointer;">‚Ü©Ô∏è</button>
        <button onclick="redo()" title="Redo (Ctrl+Y)" style="background:none; border:none; cursor:pointer;">‚Ü™Ô∏è</button>
    </aside>

    <main class="workspace">
        <div id="canvas-container" style="width: 800px; height: 600px;">
            <!-- Camadas ser√£o inseridas aqui via JS -->
        </div>
    </main>

    <aside class="right-panels">
        <div class="panel-header">Camadas (Layers)</div>
        <div class="layer-list" id="layer-list">
            <!-- Lista de camadas via JS -->
        </div>
        <div class="layer-controls">
            <button class="btn-sm" onclick="addNewLayer()"> Nova Camada </button>
            <button class="btn-sm" onclick="deleteActiveLayer()"> Deletar </button>
        </div>
        
        <div class="panel-header">A√ß√µes R√°pidas</div>
        <div style="padding: 10px; display: flex; flex-direction: column; gap: 5px;">
            <button class="btn-sm" onclick="exportImage()">Exportar PNG</button>
            <button class="btn-sm" onclick="applyInvert()">Inverter Cores</button>
        </div>
    </aside>
</div>

<script>
    const container = document.getElementById('canvas-container');
    const layerListUI = document.getElementById('layer-list');
    
    let layers = [];
    let activeLayerIndex = -1;
    let isDrawing = false;
    let history = [];
    let historyStep = -1;

    // --- CONFIGURA√á√ïES DE FERRAMENTA ---
    let currentTool = 'brush';
    const config = {
        get size() { return document.getElementById('brush-size').value },
        get opacity() { return document.getElementById('brush-opacity').value / 100 },
        get color() { return document.getElementById('color-picker').value },
        get type() { return document.getElementById('brush-type').value }
    };

    // --- INICIALIZA√á√ÉO ---
    function init() {
        addNewLayer("Plano de Fundo");
        saveState();
    }

    function addNewLayer(name = `Camada ${layers.length + 1}`) {
        const canvas = document.createElement('canvas');
        canvas.width = container.offsetWidth;
        canvas.height = container.offsetHeight;
        
        const layerObj = {
            id: Date.now(),
            name: name,
            canvas: canvas,
            ctx: canvas.getContext('2d'),
            visible: true
        };

        layers.push(layerObj);
        container.appendChild(canvas);
        selectLayer(layers.length - 1);
        renderLayerList();
    }

    function selectLayer(index) {
        activeLayerIndex = index;
        document.querySelectorAll('canvas').forEach((c, i) => {
            c.classList.toggle('active-layer', i === index);
        });
        renderLayerList();
    }

    function renderLayerList() {
        layerListUI.innerHTML = '';
        [...layers].reverse().forEach((layer, originalIndex) => {
            const idx = layers.indexOf(layer);
            const div = document.createElement('div');
            div.className = `layer-item ${idx === activeLayerIndex ? 'selected' : ''}`;
            div.onclick = () => selectLayer(idx);
            
            div.innerHTML = `
                <span class="visibility" onclick="toggleVisibility(${idx})">${layer.visible ? 'üëÅÔ∏è' : 'üö´'}</span>
                <span>${layer.name}</span>
            `;
            layerListUI.appendChild(div);
        });
    }

    function toggleVisibility(idx) {
        layers[idx].visible = !layers[idx].visible;
        layers[idx].canvas.style.display = layers[idx].visible ? 'block' : 'none';
        renderLayerList();
    }

    // --- SISTEMA DE DESENHO ---
    let lastX = 0;
    let lastY = 0;

    container.addEventListener('mousedown', (e) => {
        if (activeLayerIndex === -1) return;
        isDrawing = true;
        const rect = container.getBoundingClientRect();
        lastX = e.clientX - rect.left;
        lastY = e.clientY - rect.top;
    });

    window.addEventListener('mouseup', () => {
        if (isDrawing) {
            isDrawing = false;
            saveState();
        }
    });

    container.addEventListener('mousemove', draw);

    function draw(e) {
        if (!isDrawing) return;
        const layer = layers[activeLayerIndex];
        const ctx = layer.ctx;
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        ctx.globalAlpha = config.opacity;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        
        if (currentTool === 'eraser') {
            ctx.globalCompositeOperation = 'destination-out';
        } else {
            ctx.globalCompositeOperation = 'source-over';
        }

        if (config.type === 'soft') {
            ctx.shadowBlur = config.size / 2;
            ctx.shadowColor = config.color;
        } else {
            ctx.shadowBlur = 0;
        }

        ctx.strokeStyle = config.color;
        ctx.lineWidth = config.size;

        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();

        lastX = x;
        lastY = y;
    }

    // --- UNDO / REDO ---
    function saveState() {
        historyStep++;
        // Captura o estado de todas as camadas
        const state = layers.map(l => l.canvas.toDataURL());
        history = history.slice(0, historyStep);
        history.push(state);
    }

    function undo() {
        if (historyStep > 0) {
            historyStep--;
            loadState(history[historyStep]);
        }
    }

    function redo() {
        if (historyStep < history.length - 1) {
            historyStep++;
            loadState(history[historyStep]);
        }
    }

    function loadState(state) {
        state.forEach((dataUrl, index) => {
            if (layers[index]) {
                const img = new Image();
                img.onload = () => {
                    layers[index].ctx.clearRect(0, 0, container.offsetWidth, container.offsetHeight);
                    layers[index].ctx.drawImage(img, 0, 0);
                };
                img.src = dataUrl;
            }
        });
    }

    // --- UTILIT√ÅRIOS ---
    function exportImage() {
        const finalCanvas = document.createElement('canvas');
        finalCanvas.width = container.offsetWidth;
        finalCanvas.height = container.offsetHeight;
        const finalCtx = finalCanvas.getContext('2d');

        layers.forEach(l => {
            if (l.visible) finalCtx.drawImage(l.canvas, 0, 0);
        });

        const link = document.createElement('a');
        link.download = 'projeto-photojs.png';
        link.href = finalCanvas.toDataURL();
        link.click();
    }

    function applyInvert() {
        const layer = layers[activeLayerIndex];
        const imageData = layer.ctx.getImageData(0, 0, layer.canvas.width, layer.canvas.height);
        const data = imageData.data;
        for (let i = 0; i < data.length; i += 4) {
            data[i] = 255 - data[i];
            data[i+1] = 255 - data[i+1];
            data[i+2] = 255 - data[i+2];
        }
        layer.ctx.putImageData(imageData, 0, 0);
        saveState();
    }

    // --- ATALHOS ---
    window.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'z') { e.preventDefault(); undo(); }
        if (e.ctrlKey && e.key === 'y') { e.preventDefault(); redo(); }
        if (e.key === 'b') setActiveTool('brush');
        if (e.key === 'e') setActiveTool('eraser');
    });

    function setActiveTool(tool) {
        currentTool = tool;
        document.querySelectorAll('.tool-icon').forEach(i => i.classList.remove('active'));
        document.getElementById(`tool-${tool}`).classList.add('active');
    }

    document.getElementById('tool-brush').onclick = () => setActiveTool('brush');
    document.getElementById('tool-eraser').onclick = () => setActiveTool('eraser');

    init();
</script>
</body>
</html>
