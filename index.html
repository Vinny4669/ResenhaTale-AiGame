<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResenhaTale: Extreme üëÄ</title>
    <style>
        @font-face {
            font-family: 'Determination';
            src: url('https://fonts.cdnfonts.com/s/15443/DeterminationMonoWebRegular.woff') format('woff');
        }

        body {
            background-color: black;
            color: white;
            font-family: 'Determination', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        /* INIMIGO */
        #enemy-container { height: 180px; text-align: center; position: relative; }
        #enemy-img { width: 130px; transition: filter 0.1s; }
        .enemy-hp-bar { width: 160px; height: 12px; background: #333; border: 2px solid white; margin: 10px auto; }
        #enemy-hp-fill { width: 100%; height: 100%; background: #00ff00; transition: 0.3s; }

        /* CAIXA DE BATALHA */
        #box {
            width: 400px; height: 180px;
            border: 5px solid white;
            position: relative;
            background: black;
            overflow: hidden;
        }

        #soul {
            position: absolute; width: 16px; height: 16px;
            display: none; z-index: 100;
        }

        /* ATAQUES */
        .bullet { position: absolute; background: white; pointer-events: none; }
        .orange { background: #ffa500 !important; box-shadow: 0 0 10px #ffa500; }
        .blue { background: #008cff !important; box-shadow: 0 0 10px #008cff; }
        
        .blaster-warning { position: absolute; background: rgba(255, 255, 255, 0.2); border: 1px dashed white; pointer-events: none; }
        .blaster-beam { position: absolute; background: white; box-shadow: 0 0 20px white; pointer-events: none; }

        /* BARRA DE ATAQUE (SLIDER) */
        #attack-ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center;
        }
        #slider-container {
            width: 380px; height: 120px;
            background: url('barraataque.png') no-repeat center;
            background-size: 100% 100%;
            position: relative;
            border: 2px solid #555;
        }
        #slider-line {
            position: absolute; width: 8px; height: 100%; background: white;
            box-shadow: 0 0 10px white; left: 0;
        }

        /* STATUS */
        #status { width: 400px; margin: 15px 0; display: flex; align-items: center; font-size: 20px;}
        .hp-bar-bg { width: 100px; height: 20px; background: red; margin: 0 10px; }
        #hp-fill { width: 100%; height: 100%; background: #ffff00; }

        /* BOT√ïES */
        .buttons { display: flex; gap: 10px; width: 420px; justify-content: space-between; }
        .btn { border: 2px solid #e27d31; color: #e27d31; padding: 8px; width: 95px; text-align: center; cursor: pointer; }
        .btn:hover { border-color: white; color: white; background: #e27d31; }

        /* GAME OVER */
        #game-over {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 1000;
        }
    </style>
</head>
<body>

    <div id="enemy-container">
        <img src="resenha.png" id="enemy-img" alt="üëÄ" onerror="this.src='https://emojicdn.elk.sh/üëÄ?size=130'">
        <div class="enemy-hp-bar"><div id="enemy-hp-fill"></div></div>
    </div>

    <div id="box">
        <div id="dialogue" style="padding: 15px; font-size: 18px;"></div>
        <img id="soul" src="https://i.imgur.com/u7f3RCH.png" alt="‚ù§Ô∏è">
        
        <div id="attack-ui">
            <div id="slider-container">
                <div id="slider-line"></div>
            </div>
        </div>
    </div>

    <div id="status">
        PLAYER  LV 19  HP <div class="hp-bar-bg"><div id="hp-fill"></div></div> <span id="hp-text">50 / 50</span>
    </div>

    <div class="buttons">
        <div class="btn" onclick="startAttackMenu()">LUTAR</div>
        <div class="btn" onclick="openMsg('* Voc√™ checa a Resenha.\n* Ela parece entediada.')">AGIR</div>
        <div class="btn" onclick="useItem()">ITEM</div>
        <div class="btn" onclick="openMsg('* A Resenha ignora seu perd√£o.')">POUPAR</div>
    </div>

    <div id="game-over">
        <img src="https://i.imgur.com/u7f3RCH.png" style="width: 30px; margin-bottom: 20px;">
        <h1 style="color: white; text-align: center;">VOC√ä EST√Å MORTO.<br><span style="color:red; font-size: 20px;">MANTENHA A DETERMINA√á√ÉO...</span></h1>
        <button onclick="location.reload()" style="background:none; border:2px solid white; color:white; padding:10px; cursor:pointer;">REPETIR</button>
    </div>

    <script>
        const soul = document.getElementById('soul');
        const box = document.getElementById('box');
        const dialogue = document.getElementById('dialogue');
        const hpFill = document.getElementById('hp-fill');
        const hpText = document.getElementById('hp-text');
        const enemyHpFill = document.getElementById('enemy-hp-fill');
        const attackUi = document.getElementById('attack-ui');
        const sliderLine = document.getElementById('slider-line');

        let playerHp = 50, maxHp = 50;
        let enemyHp = 150, maxEnemyHp = 150;
        let gameState = 'menu'; 
        let soulX = 192, soulY = 82;
        let keys = {};
        let isMoving = false;

        function typeWriter(text, next) {
            gameState = 'typing';
            dialogue.innerHTML = "";
            let i = 0;
            const interval = setInterval(() => {
                dialogue.innerHTML += text.charAt(i);
                i++;
                if (i >= text.length) {
                    clearInterval(interval);
                    gameState = 'menu';
                    if (next) setTimeout(next, 1000);
                }
            }, 30);
        }

        typeWriter("* A Resenha te desafia.");

        function openMsg(msg) {
            if (gameState !== 'menu') return;
            typeWriter(msg, startEnemyTurn);
        }

        // --- SISTEMA DE ATAQUE (BARRAATAQUE.PNG) ---
        let sliderPos = 0;
        let sliderActive = false;

        function startAttackMenu() {
            if (gameState !== 'menu') return;
            gameState = 'attacking';
            attackUi.style.display = 'flex';
            sliderPos = 0;
            sliderActive = true;
            animateSlider();
        }

        function animateSlider() {
            if (!sliderActive) return;
            sliderPos += 6;
            if (sliderPos > 370) {
                stopAttack(0); // Errou se passar direto
                return;
            }
            sliderLine.style.left = sliderPos + 'px';
            requestAnimationFrame(animateSlider);
        }

        window.addEventListener('keydown', e => {
            if ((e.key === 'z' || e.key === 'Enter') && sliderActive) {
                stopAttack(sliderPos);
            }
        });

        function stopAttack(pos) {
            sliderActive = false;
            attackUi.style.display = 'none';
            
            // L√≥gica baseada na sua imagem barraataque.png
            // Centro (verde) √© em aprox 190px (50% de 380px)
            let distToCenter = Math.abs(190 - pos);
            let damage = 0;

            if (distToCenter < 15) damage = 25;      // VERDE (Perfeito)
            else if (distToCenter < 40) damage = 15; // AMARELO
            else if (distToCenter < 80) damage = 8;  // LARANJA
            else if (distToCenter < 150) damage = 3; // VERMELHO
            else damage = 0;

            enemyHp -= damage;
            updateEnemy();
            typeWriter(`* Voc√™ causou ${damage} de dano!`, () => {
                if (enemyHp <= 0) win(); else startEnemyTurn();
            });
        }

        // --- ATAQUES DO INIMIGO ---
        function startEnemyTurn() {
            gameState = 'enemy_turn';
            dialogue.innerHTML = "";
            soul.style.display = 'block';
            soulX = 192; soulY = 82;
            
            const patterns = [attackProjectiles, attackBlaster, attackWalls];
            const chosen = patterns[Math.floor(Math.random() * patterns.length)];
            
            chosen();
            setTimeout(() => {
                if (gameState === 'enemy_turn') endTurn();
            }, 6000);
        }

        // 1. ATAQUE QUADRADOS DIRECIONADOS
        function attackProjectiles() {
            let count = 0;
            const interval = setInterval(() => {
                if (gameState !== 'enemy_turn') return clearInterval(interval);
                // Mira na posi√ß√£o atual do player
                let targetX = soulX;
                let targetY = soulY;
                createBullet(190, -20, (targetX - 190)/30, (targetY + 20)/30, 15, 15);
                count++;
                if (count > 12) clearInterval(interval);
            }, 400);
        }

        // 2. GASTER BLASTER (MIRA E ATIRA)
        function attackBlaster() {
            let count = 0;
            const interval = setInterval(() => {
                if (gameState !== 'enemy_turn') return clearInterval(interval);
                
                let isVertical = Math.random() > 0.5;
                let warn = document.createElement('div');
                warn.className = 'blaster-warning';
                
                if (isVertical) {
                    let posX = soulX;
                    warn.style.width = '40px'; warn.style.height = '180px';
                    warn.style.left = posX + 'px'; warn.style.top = '0';
                    box.appendChild(warn);
                    setTimeout(() => {
                        warn.remove();
                        fireBeam(posX, 0, 40, 180);
                    }, 800);
                } else {
                    let posY = soulY;
                    warn.style.width = '400px'; warn.style.height = '40px';
                    warn.style.left = '0'; warn.style.top = posY + 'px';
                    box.appendChild(warn);
                    setTimeout(() => {
                        warn.remove();
                        fireBeam(0, posY, 400, 40);
                    }, 800);
                }
                count++;
                if (count > 4) clearInterval(interval);
            }, 1200);
        }

        function fireBeam(x, y, w, h) {
            let beam = document.createElement('div');
            beam.className = 'blaster-beam';
            beam.style.left = x + 'px'; beam.style.top = y + 'px';
            beam.style.width = w + 'px'; beam.style.height = h + 'px';
            box.appendChild(beam);
            
            // Dano do Beam
            let check = setInterval(() => {
                if (soulX < x + w && soulX + 16 > x && soulY < y + h && soulY + 16 > y) {
                    takeDamage(2);
                }
            }, 50);

            setTimeout(() => { beam.remove(); clearInterval(check); }, 400);
        }

        // 3. PAREDES AZUIS E LARANJAS
        function attackWalls() {
            let count = 0;
            const interval = setInterval(() => {
                if (gameState !== 'enemy_turn') return clearInterval(interval);
                
                let type = Math.random() > 0.5 ? 'blue' : 'orange';
                let wall = document.createElement('div');
                wall.className = 'bullet ' + type;
                wall.style.width = '20px'; wall.style.height = '180px';
                wall.style.left = '400px'; wall.style.top = '0';
                box.appendChild(wall);

                let wx = 400;
                let move = setInterval(() => {
                    wx -= 5;
                    wall.style.left = wx + 'px';
                    
                    // L√≥gica de Cor:
                    if (wx < soulX + 16 && wx + 20 > soulX) {
                        if (type === 'blue' && isMoving) takeDamage(3); // Azul: N√£o se mexa
                        if (type === 'orange' && !isMoving) takeDamage(3); // Laranja: Se mexa
                    }

                    if (wx < -30) { wall.remove(); clearInterval(move); }
                    if (gameState !== 'enemy_turn') { wall.remove(); clearInterval(move); }
                }, 20);

                count++;
                if (count > 6) clearInterval(interval);
            }, 800);
        }

        function createBullet(x, y, vx, vy, w, h) {
            const b = document.createElement('div');
            b.className = 'bullet';
            b.style.width = w+'px'; b.style.height = h+'px';
            box.appendChild(b);
            const m = setInterval(() => {
                x+=vx; y+=vy;
                b.style.left = x+'px'; b.style.top = y+'px';
                if (x < soulX+14 && x+w > soulX && y < soulY+14 && y+h > soulY) takeDamage(2);
                if (x<-50||x>450||y<-50||y>250||gameState!=='enemy_turn'){ b.remove(); clearInterval(m); }
            }, 20);
        }

        function takeDamage(amt) {
            playerHp -= amt;
            updateUI();
            if (playerHp <= 0) die();
        }

        function updateUI() {
            hpFill.style.width = (playerHp/maxHp*100) + "%";
            hpText.innerText = Math.max(0, Math.floor(playerHp)) + " / 50";
        }

        function updateEnemy() {
            enemyHpFill.style.width = Math.max(0, (enemyHp/maxEnemyHp)*100) + "%";
            document.getElementById('enemy-img').style.filter = "invert(1)";
            setTimeout(() => document.getElementById('enemy-img').style.filter = "none", 100);
        }

        function endTurn() {
            gameState = 'menu';
            soul.style.display = 'none';
            typeWriter("* A Resenha est√° perdendo a paci√™ncia.");
        }

        function die() {
            gameState = 'dead';
            document.getElementById('game-over').style.display = 'flex';
        }

        function win() {
            gameState = 'win';
            typeWriter("* VOC√ä VENCEU!\n* A resenha acabou por hoje.");
            document.getElementById('enemy-img').style.opacity = '0';
        }

        // CONTROLES
        window.addEventListener('keydown', e => { keys[e.key] = true; isMoving = true; });
        window.addEventListener('keyup', e => { 
            keys[e.key] = false; 
            if (!keys['ArrowUp'] && !keys['ArrowDown'] && !keys['ArrowLeft'] && !keys['ArrowRight'] &&
                !keys['w'] && !keys['s'] && !keys['a'] && !keys['d']) {
                isMoving = false;
            }
        });

        setInterval(() => {
            if (gameState === 'enemy_turn') {
                const s = 3.5;
                if (keys['ArrowUp'] || keys['w']) soulY -= s;
                if (keys['ArrowDown'] || keys['s']) soulY += s;
                if (keys['ArrowLeft'] || keys['a']) soulX -= s;
                if (keys['ArrowRight'] || keys['d']) soulX += s;
                soulX = Math.max(0, Math.min(384, soulX));
                soulY = Math.max(0, Math.min(164, soulY));
                soul.style.left = soulX + 'px';
                soul.style.top = soulY + 'px';
            }
        }, 20);

        function useItem() {
            if (gameState !== 'menu') return;
            playerHp = 50;
            updateUI();
            typeWriter("* Voc√™ tomou o Sucu do Istilitiru.\n* HP Restaurado!", startEnemyTurn);
        }
    </script>
</body>
</html>
